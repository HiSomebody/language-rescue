
<html>
<head>
<meta property="og:title" content="Friends in a Box" />
<meta property="og:site_name" content="FriendsInABox" />
<meta property="og:type" content="game.achievement" />
<meta property="og:url" content="http://operationlanguagerescue.com/friendsinabox" />
<meta property="og:description" content="Observe the friends in a box together!" />
<meta property="og:image" content="https://students.cs.byu.edu/~psoder3/Friends/friendsImg.png"/>
<link rel="image_src" href="https://students.cs.byu.edu/~psoder3/Friends/friendsImg.png"/>
<title>Friends in a Box</title>

<script>
var personsOutOfBox = [];
var personsInBox = [];
var canvas;
var currentPlayer = {};
var selectCurrent = document.createElement("SELECT");
var selectRemove = document.createElement("SELECT");
var selectAdd = document.createElement("SELECT");
var option11 = document.createElement("option");
	option11.text = "select";
	selectAdd.add(option11);
var option22 = document.createElement("option");
	option22.text = "select";
	selectRemove.add(option22);
var option33 = document.createElement("option");
	option33.text = "select";
	selectCurrent.add(option33);
selectCurrent.onchange = SwapControl;
selectRemove.onfocus = RemoveFromBox;
selectRemove.onchange = RemoveFromBox;
selectAdd.onchange = AddToBox;

function SwapControl(){
	for (var i = 0; i < personsInBox.length; i++)
	{
		if (personsInBox[i].name == this.value)
		{
			currentPlayer = personsInBox[i];
			return;
		}
	}
}

function RotateCurrent(index){
	for (var i = 0; i < personsInBox.length-1; i++)
	{
		var temp = persons[i];
		persons[i] = persons[i+1];
		persons[i+1] = temp;
		currentPlayer = persons[0];
	}
}


function RemoveFromBox(){
	//var x = document.getElementById(player.name+"option");
	var player;
	var found = false;
	for (var i = 0; i < personsInBox.length; i++)
	{
		if (personsInBox[i].name == this.value)
		{
			player = personsInBox[i];
			personsInBox.splice(i, 1);
			found = true;
			break;
		}
	}
	if (found){
		personsOutOfBox.push(player);
		var option2 = document.createElement("option");
		option2.text = player.name;
		option2.id = player.name+"option";
		selectAdd.add(option2);
		selectRemove.remove(selectRemove.selectedIndex);
		selectCurrent.remove(selectRemove.selectedIndex);
	}
}

function AddToBox(){
	var player;
	var found = false;
	for (var i = 0; i < personsOutOfBox.length; i++)
	{
		if (personsOutOfBox[i].name == this.value)
		{
			player = personsOutOfBox[i];
			personsOutOfBox.splice(i, 1);
			found = true;
			break;
		}
	}
	if (found){
		personsInBox.push(player);
		var option = document.createElement("option");
		option.text = player.name;
		option.id = player.name+"option";
		selectCurrent.add(option);
		var option2 = document.createElement("option");
		option2.text = player.name;
		option2.id = player.name+"option";
		selectRemove.add(option2);
		selectAdd.remove(selectAdd.selectedIndex);
	}
}

function AddToList(player){
	var option = document.createElement("option");
	option.text = player.name;
	selectAdd.add(option);
	personsOutOfBox.push(player);
}

window.onload = function() {
  canvas = document.createElement("canvas");

  var context = canvas.getContext("2d");
  
  var canvasWidth = 900;
  var canvasHeight = 500;
  var totalMoney = 1;
  canvas.width = canvasWidth;
  canvas.height = canvasHeight;
  document.body.appendChild(canvas);
  var linebreak2 = document.createElement("br");
  document.body.appendChild(linebreak2);
  var tagline3 = document.createTextNode("Add");
  document.body.appendChild(tagline3);
  document.body.appendChild(selectAdd);
  var tagline4 = document.createTextNode("Remove");
  document.body.appendChild(tagline4);
  document.body.appendChild(selectRemove);
  var tagline2 = document.createTextNode("Current");
  document.body.appendChild(tagline2);
  document.body.appendChild(selectCurrent);
  var linebreak = document.createElement("br");
  document.body.appendChild(linebreak);
  var linebreak3 = document.createElement("br");
  document.body.appendChild(linebreak3);
  var tagline = document.createTextNode("created by Paul Soderquist");
  document.body.appendChild(tagline);


  var personHeight = 90;
  var moveAmount = 10;
  var walkingMMInterval = 120;
  var counter = 0;

  
  var PAUL = {name:'Paul',imgName:'Paul',personX:0,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:1,pants:1,shoes:1,offset:0};
  var ZACH = {name:'Zach',imgName:'Zach',personX:160,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:0};
  var DALLIN = {name:'Dallin',imgName:'Dallin',personX:320,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:0};
  var ELENA = {name:'Elena',imgName:'Elena',personX:480,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:0};
  var MIKAYLA = {name:'Mikayla',imgName:'MikaylaBetterHair',personX:640,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:-15};
  var MICHELLE = {name:'Michelle',imgName:'Michelle',personX:800,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:0};
  var ELYSSA = {name:'Elyssa',imgName:'Elyssa',personX:80,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:0};
  var HANNAH = {name:'Hannah',imgName:'HannahShorter',personX:240,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:-10};
  var CAITLIN = {name:'Caitlin',imgName:'Caitlin',personX:400,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:-5};
  var SADEE = {name:'Sadee',imgName:'Sadee',personX:560,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:-5};
  var MATTHEW = {name:'Matthew',imgName:'Matthew',personX:720,personY:canvasHeight-personHeight,rightLeft:'Right',moving:false,rotation:6,numSteps:0,shirt:2,pants:2,shoes:2,offset:0};

  AddToList(PAUL);
  AddToList(ZACH);
  AddToList(DALLIN);
  AddToList(ELENA);
  AddToList(MIKAYLA);
  AddToList(MICHELLE);
  AddToList(ELYSSA);
  AddToList(HANNAH);
  AddToList(CAITLIN);
  AddToList(SADEE);
  AddToList(MATTHEW);

  //currentPlayer = personsInBox[0];
  var leftKey = 37;
  var rightKey = 39;

  canvas.addEventListener('click', function() {
	//if (falling) {return;}
	
}, false);

/*
// Draw a red circle particle on the canvas
context.beginPath();
context.fillStyle = colorRed;
// After setting the fill style, draw an arc on the canvas
context.arc(100, 200, 10, 0, Math.PI*2, true); 
context.closePath();
context.fill();
*/

/*
// Draw a green circle particle on the canvas
context.beginPath();
context.fillStyle = colorGreen;
// After setting the fill style, draw an arc on the canvas
context.arc(300, 200, 10, 0, Math.PI*2, true); 
context.closePath();
context.fill();
*/

// Draw shapes on the canvas using an interval of 30ms
setInterval(function() {

	
  context.fillStyle = "gray";
  context.fillRect(0,0,canvas.width, canvas.height);

	for (var i = 0; i < personsInBox.length; i++)
	{
		var p = personsInBox[i];
		var personName = p.name;
		var direction = 'HeadOn';
		
		
		if (p.rotation == 3 || p.rotation == 6)
		{
			direction = 'HeadOn';
		}
		else if (p.rightLeft == 'Right') 
		{
			if (p.rotation == 1)
			{
				direction = 'RightLeft';
			}
			else if (p.rotation == 4) 
			{
				direction = 'RightRight';
			}
			else if (p.rotation == 2 || p.rotation == 5)
			{
				direction = 'RightCenter';
			}
			if (p.personX < canvasWidth + 100)
			{
				p.personX += moveAmount;
			}
		}
		else if (p.rightLeft == 'Left')
		{
			if (p.rotation == 1)
			{
				direction = 'LeftLeft';
			}
			else if (p.rotation == 4)
			{
				direction = 'LeftRight';
			}
			else if (p.rotation == 2 || p.rotation == 5)
			{
				direction = 'LeftCenter';
			}
			if (p.personX > -100)
			{
				p.personX -= moveAmount;
			}
		}
		else
		{
			console.log('Hit Error Branch');
		}
		
		var personX = p.personX;
		var personY = p.personY;
		drawPerson(p,direction,personX,personY);
		//if (counter % 2 == 0)
		{
			if (p.moving)
			{
				p.rotation++;
				if (p.rotation == 3 || p.rotation == 6) {
					p.moving = false;
					p.numSteps--;
				}
			}
		}		
	}
}, walkingMMInterval);

setInterval(function()
{
	for (var i = 0; i < personsInBox.length; i++)
	{
		var player = personsInBox[i];
		if (player.numSteps > 0)
		{
			player.lastNum = player.numSteps;
			if (player.moving == false)
			{
				movePlayer(player);
			}
		}
	}
	
	if (Math.random() < .03 && personsInBox.length > 0)
	{
		console.log("length" + personsInBox.length);
		var playerIndex = Math.floor((Math.random()*(personsInBox.length-1)));
		console.log(playerIndex);
		var p = personsInBox[playerIndex];
		p.numSteps = (Math.floor((Math.random()*1000))%8)+1;
		console.log(p.numSteps);
		p.rightLeft = (Math.random() < .5)? 'Right':'Left';
	}		

}, 30);

function drawPerson(player,direction,x,y) {
  var ctx = canvas.getContext('2d');
  var headImg = new Image();
  var shirtImg = new Image();
  var pantsImg = new Image();
  var shoesImg = new Image();
  /*
  var img = new Image();
  img.src = 'PaintNetFiles/Rendered/'+player.name+direction+'.png';
  img.onload = function(){
    ctx.drawImage(img,x,y);
  }
  */
  var Local = true;
  if (Local)
  {
  	shirtImg.src = 'Avatars/Shirts/'+player.shirt+'/'+direction+'.png';
  	pantsImg.src = 'Avatars/Pants/'+player.pants+'/'+direction+'.png';
  	shoesImg.src = 'Avatars/Shoes/'+player.shoes+'/'+direction+'.png';
  	headImg.src = 'Avatars/Heads/'+player.imgName+'.png';
  }
  else
  {
	shirtImg.src = 'GAMES/FriendsInABox/Avatars/Shirts/'+player.shirt+'/'+direction+'.png';
  	pantsImg.src = 'GAMES/FriendsInABox/Avatars/Pants/'+player.pants+'/'+direction+'.png';
  	shoesImg.src = 'GAMES/FriendsInABox/Avatars/Shoes/'+player.shoes+'/'+direction+'.png';
  	headImg.src = 'GAMES/FriendsInABox/Avatars/Heads/'+player.imgName+'.png';
  }
  var headX = x+player.offset;
  
  shirtImg.onload = function(){
    ctx.drawImage(shirtImg,x,y);
  }
  pantsImg.onload = function(){
    ctx.drawImage(pantsImg,x,y);
  }
  shoesImg.onload = function(){
    ctx.drawImage(shoesImg,x,y);
  }
  headImg.onload = function(){
	if (direction == 'LeftLeft' || direction == 'LeftRight')
    {
		ctx.drawImage(headImg,headX-1,y+2);
	}
	else if (direction == 'RightLeft' || direction == 'RightRight')
	{
		ctx.drawImage(headImg,headX+1,y+2);
	}
	else
	{
		ctx.drawImage(headImg,headX,y);
	}
  }
}

document.onkeydown = checkKey;

function movePlayer(player) {
	player.moving = true;
	player.rotation++;
	if (player.rotation > 6) 
	{player.rotation = 1;}
	//console.log(player.rotation);
	
}

function checkKey(e) {
	if (currentPlayer.moving)
	{
		return;
	}
    e = e || window.event;

    if (e.keyCode == '38') {
        // up arrow
    }
    else if (e.keyCode == '40') {
        // down arrow
    }
    else if (e.keyCode == leftKey) {
		currentPlayer.numSteps = 1;
		currentPlayer.rightLeft = 'Left';
	    movePlayer(currentPlayer);
    }
    else if (e.keyCode == rightKey) {
		currentPlayer.numSteps = 1;
		currentPlayer.rightLeft = 'Right';
		movePlayer(currentPlayer);
    }

}

}
</script>
</head>
<body style="text-align:center">

<a id="fb-share" style='text-decoration:none;' type="icon_link" onClick="ScreenShotShare();" href="javascript: void(0)"><input type="button" value="Share"></a>

<input type="button" value="Take Screen Shot" onclick="ScreenShot();">
<input type="button" value="Change Player" onclick="RotateCurrent(1);">
<br>
<h1 style="font-family:Calibri">Friends in a Box</h1>

<p>
Add people to the box!
</p>
</body>
</html>

