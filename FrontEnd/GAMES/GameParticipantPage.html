<!-- Begin stream -->
<html>
	<head><script>
		var username;
		var code;
		
		var HttpClient = function() {
		    this.get = function(aUrl, aCallback) {
		        var anHttpRequest = new XMLHttpRequest();
		        anHttpRequest.onreadystatechange = function() { 
		            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
		                aCallback(anHttpRequest.responseText);
		        }

		        anHttpRequest.open( "GET", aUrl, true );            
		        anHttpRequest.send( null );
		    }
		}
		
		
		window.history.replaceState('', 'Game Hub', '/test');
		
		function initializeGame(players)
		{
			var playersDiv = document.getElementById("playersDiv");
			
			for (var i = 0; i < players.length; i++)
			{
				var playerDiv = document.createElement("div");
				var nameLbl = document.createTextNode(players[i].name + ": ");
				var message = document.createTextNode(players[i].text);
				playerDiv.setAttribute("id","player"+players[i].name);
				var imgDiv = document.createElement("img");
				imgDiv.height=50;
				imgDiv.src = players[i].image;
				//tagLineDiv.setAttribute("text-align","center");
				imgDiv.setAttribute("id","img"+players[i].name);
				playerDiv.appendChild(imgDiv);
				playerDiv.appendChild(nameLbl);
				playerDiv.appendChild(message);
				playersDiv.appendChild(playerDiv);
			}
		}
		
		window.onload = function()
		{
			code = importantData["code"];//GetURLParameter("gameCode");
			document.getElementById("GameCodeHeader").innerHTML = "Game Code: " + code;
			username = importantData["username"];//GetURLParameter("username");
			document.getElementById("NameHeader").innerHTML = "Name: " + username;
			
			var client = new HttpClient();
			client.get('http://104.236.169.62:80/loadGameForClient/'+code, function(response) {
				var parsedJSON = (JSON.parse(response));
			    console.log(parsedJSON["players"]);
				if (parsedJSON["result"] == "success")
				{
					initializeGame(parsedJSON['players']);
				}
				else
				{
					document.removeChild(document.documentElement);
					var playerDiv = document.createElement("div");
					playersDiv.appendChild(playerDiv);
					var message = document.createTextNode(parsedJSON["err"]);
					playerDiv.appendChild(message);
				}
			});
			
			
			
			
		}
		
		var GetURLParameter = function(sParam)
		{
			var sPageURL = window.location.search.substring(1);
			var sURLVariables = sPageURL.split('&');
			for (var i = 0; i < sURLVariables.length; i++) 
			{
				var sParameterName = sURLVariables[i].split('=');
				if (sParameterName[0] == sParam) 
				{
					return sParameterName[1];
				}
			}
		}
		
		function changeAvatar()
		{
			var src = document.getElementById("srcInputField").value;
			document.getElementById("img"+username).src = src;
		}
		
		function changeMessage()
		{
			var message = document.getElementById("chatInputField").value;
			document.getElementById("player"+username).childNodes[2].nodeValue = message;
		}
		
		
		
		</script>
	</head>
	<body>
		<h2 id="GameCodeHeader">Game Code:</h2>
		<h2 id="NameHeader">Name:</h2>
		<div style="text-align:center" id="gameDiv">
			<div id="playersDiv"></div>
			<br>
			<input placeholder="Type Message" id="chatInputField"/>
			<button onclick="changeMessage()">Send</button>
			<br><br>
			<input placeholder="avatar img URL" id="srcInputField"/>
			<button onclick="changeAvatar()">Change Avatar</button>
			
		</div>
	</body>
</html>

<!-- End stream -->