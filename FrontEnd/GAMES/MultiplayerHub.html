<html>
	<head>
		<script>
			
			var HttpClient = function() {
			    this.get = function(aUrl, aCallback) {
			        var anHttpRequest = new XMLHttpRequest();
			        anHttpRequest.onreadystatechange = function() { 
			            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
			                aCallback(anHttpRequest.responseText);
			        }

			        anHttpRequest.open( "GET", aUrl, true );            
			        anHttpRequest.send( null );
			    }
				
				this.post = function(aUrl, aCallback) {
				var xhttp = new XMLHttpRequest();
				  xhttp.onreadystatechange = function() {
				    if (this.readyState == 4 && this.status == 200) {
				      	aCallback(xhttp.responseText);
				    }
				  };
				  xhttp.open("POST", aUrl, true);
				  xhttp.send();
			  }
			}
			
			//var port = 80;
		window.onload = function()
		{
			console.log(window.location.href)
		}
		
		function showCreateGameForm()
		{
			document.getElementById("gameCode").style.display = "none";
			document.getElementById("generateCodeButton").disabled = true;
			var createGameForm = document.getElementById("createGameForm");
			createGameForm.style.display = "block";
		}
		
		function getRandomAlphaNumeric()
		{
			var index = Math.floor(Math.random()*36);
			var char;
			if (index <= 25)
			{
				char = String.fromCharCode(index+65);
			}
			else
			{
				index -= 26;
				char = index.toString();
			}
			return char;
		}
		
		function addGameToServer(choice)
		{
			// server call blah, blah
			
			var gameCode = "";
			for (var i = 0; i < 4; i++)
			{
				gameCode += getRandomAlphaNumeric();
			}
			return gameCode;
		}
		
		function createGame()
		{
			var gameCodeElement = document.getElementById("gameCode");
			var selectOptions = document.getElementById("gameSelect");
			var choice = selectOptions.options[selectOptions.selectedIndex].text;
			
			var gameCode = addGameToServer(choice);
			gameCodeElement.innerHTML = "Game Code: " + gameCode.toUpperCase();
			gameCodeElement.style.display = "block";
			var createGameForm = document.getElementById("createGameForm");
			createGameForm.style.display = "none";
		}
		
		function enableGameSelectButton()
		{
			document.getElementById("generateCodeButton").disabled = false;
		}
		
		function enterGamePage(code,username)
		{
			//console.log(window.location.href);
			//var newPage = "/loadGameForClient/"+code;//+"/"+username;
			//console.log(newPage);
			//window.location.href = newPage;
			//window.location.href = "GameParticipantPage.html?gameCode="+code.toUpperCase()+"&username="+username;
			window.location.href = "/gamepage?gameCode="+code.toUpperCase()+"&username="+username;
		}
		
		function joinGame()
		{
			var code = document.getElementById("gameCodeEntryField").value;
			var username = document.getElementById("nameEntryField").value;
			
			var client = new HttpClient();
			client.post('http://104.236.169.62:80/addClientToGame/'+code+'/'+username, function(response) {
				var parsedJSON = (JSON.parse(response));
			    console.log(parsedJSON);
				if (parsedJSON["result"] == "success")
				{
					enterGamePage(code,username);
				}
				else
				{
					var failedDiv = document.createElement("div");
					var message = document.createTextNode(parsedJSON["err"]);
					failedDiv.appendChild(message);
					document.appendChild(failedDiv);
				}
			});	
			
			
		}
		</script>
		
		<style>
		
		</style>
	</head>
	
	<body style="text-align:center">
		<h1>Multiplayer Game Hub</h1>
		<input id="nameEntryField" placeholder="ENTER NAME"/><br>
		<input id="gameCodeEntryField" style="text-transform:uppercase;" placeholder="ENTER GAME CODE"/><button id=joinGameButton onclick="joinGame()">Join</button>
		<br><br>
		or
		<br><br>
		<button onclick="showCreateGameForm()">Create New Game</button>
		<br>
		<div hidden id="createGameForm">
			<br>
			Choose Game
			<br>
			<select  id="gameSelect" size="3">
			  <option onclick="enableGameSelectButton()">Test</option>
			  <option onclick="enableGameSelectButton()">Uno</option>
			  <option onclick="enableGameSelectButton()">Scum</option>
			</select>
			<br>
			<br>
			<button id="generateCodeButton" disabled onclick="createGame()">Generate Game Code</button>
			<br>
			<br>
		</div>
		<!-- div id="gameCode" hidden -->
			<h2 hidden id="gameCode">Game Code: A30Q</h2>
		<!-- /div -->
	</body>
</html>